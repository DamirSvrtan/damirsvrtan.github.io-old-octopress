<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Millions of Pink Lines]]></title>
  <link href="http://damirsvrtan.github.io/atom.xml" rel="self"/>
  <link href="http://damirsvrtan.github.io/"/>
  <updated>2014-11-30T15:42:29+01:00</updated>
  <id>http://damirsvrtan.github.io/</id>
  <author>
    <name><![CDATA[Damir Svrtan]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Start Using Rails Application Templates]]></title>
    <link href="http://damirsvrtan.github.io/blog/2014/11/26/use-rails-app-templates/"/>
    <updated>2014-11-26T19:57:04+01:00</updated>
    <id>http://damirsvrtan.github.io/blog/2014/11/26/use-rails-app-templates</id>
    <content type="html"><![CDATA[<p>In the last year and a half since I&rsquo;ve started working at <a href="https://infinum.co">Infinum</a>, a software development agency based in Croatia, I&rsquo;ve found my self quite often in situations where I have to create a Rails application from scratch. Those situations come accross when I have to do a new application for work, for a hackathon or just for plain fun (when I want to try out a new gem or a new release of Rails, Ruby and similar).</p>

<p>I&rsquo;ve become comfortable with a set of gems and a Rails setup that I use everyday, and it&rsquo;s quite an annoiance to do a fresh setup when I generate new apps.</p>

<p>There are a few ways to approach this problem:</p>

<!--
  1. clone an already bootstrapped Rails application
  2. create a gem for generating new applications
  3. create a Rails application template file -->


<h2>Clone an already bootstrapped Rails application</h2>

<p>I&rsquo;ve seen multiple software agencies do this, one of the latest being <a href="http://www.flatstack.com/">Flatstack</a> with their <a href="https://github.com/fs/rails-base">rails-base</a> repo.</p>

<p>This is probably the easist way to have an already bootstrapped application, but it has it&rsquo;s downsides. The biggest downside is changing the skeleton once a new Rails version is released. With the plans for Rails 5 which <a href="https://twitter.com/dhh">DHH</a> announced on <a href="https://www.youtube.com/watch?v=oQyL5rQrWu0">his talk with the Amsterdam Ruby Group</a>, everybody having a solution like this will probably have to start from scratch.</p>

<p>Besides that, I see the rails-base repo has over 800 commits, and it kinda seems too much work for a base application (even if it&rsquo;s been 4 years since the first commit).</p>

<h2>A gem for generating new applications</h2>

<p>Probably the most popular solution for doing this is the <a href="https://github.com/thoughtbot/suspenders">suspenders</a> gem by <a href="http://thoughtbot.com/">Thoughtbot</a>.</p>

<p>What they basically do is generate a new rails application and hookup after the generating process to do LOTS of setting up. They add their set of gems used on the front-end, setup the database, configure deployment on Heroku, tracking for New Relic and similar.</p>

<p>Suspenders are highly maintained and probably the best solution for agencies doing lots of Rails work. It&rsquo;s got a clean codebase so it&rsquo;s easy to fork it and do neccessary tweaking.</p>

<h2>Use a Rails application template</h2>

<p>The Rails application generator can accept an &lsquo;&ndash;template&rsquo; option which can be a path or an URL to a Ruby script:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>  rails new my_application --template <span class="s1">&#39;path_or_url_to_the_template&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once the basic application generating is done, the generator will start executing the given template. Besides writting plain Ruby, you can use <a href="https://github.com/erikhuda/thor/wiki/Getting-Started">Thor</a> methods (Rails generators also use Thor) to write more readable and expressive code. Methods such as <code>ask?</code>, <code>add_file</code>, <code>copy_file</code>, and <code>run</code> come in quite handy with scripts like these.</p>

<p>Since i don&rsquo;t need as much stuff as most agencies to get started, a <a href="https://gist.github.com/DamirSvrtan/28a28e50d639b9445bbc">simple script with merely 100 lines of code hosted on gist.github.io</a> is totally sufficient for me.</p>

<p>I create my projects with this command (&lsquo;-m&rsquo; is short for &lsquo;&ndash;template&rsquo; ):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rails new _app_name_ -m https://gist.githubusercontent.com/DamirSvrtan/28a28e50d639b9445bbc/raw/app_template.rb
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s go through each part of the template I use:</p>

<p>Create a <a href="http://robots.thoughtbot.com/bin-setup">bin/setup</a> file so new developers can start right away by executing just one command (I&rsquo;ll move this part once Rails 4.2.0 comes out, the bin/setup script will be in <a href="https://github.com/rails/rails/blob/master/railties/lib/rails/generators/rails/app/templates/bin/setup">new Rails projects by default</a>):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bin_setup_file</span> <span class="o">=</span> <span class="o">&lt;&lt;-</span><span class="no">FILE</span>
</span><span class='line'><span class="sh">#!/bin/sh</span>
</span><span class='line'><span class="sh">bundle install</span>
</span><span class='line'><span class="sh">bundle exec rake db:setup</span>
</span><span class='line'><span class="no">FILE</span>
</span><span class='line'>
</span><span class='line'><span class="n">create_file</span> <span class="s1">&#39;bin/setup&#39;</span><span class="p">,</span> <span class="n">bin_setup_file</span>
</span></code></pre></td></tr></table></div></figure>


<p>Swap the rdoc README format with markdown:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">remove_file</span> <span class="s2">&quot;README.rdoc&quot;</span>
</span><span class='line'><span class="n">create_file</span> <span class="s2">&quot;README.md&quot;</span><span class="p">,</span> <span class="s2">&quot;Development: run ./bin/setup&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since I always use SASS, I would always have to change the main stylesheet extension (would often wonder why my sassy stylesheets aren&rsquo;t working as expected):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">run</span> <span class="s1">&#39;mv app/assets/stylesheets/application.css app/assets/stylesheets/application.scss&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>I either use postgres or mysql (merging soon to postgres exclusivly) so I add the appropriate database driver and change the configuration file. A cool thing with Thor is that you can ask the user questions, which I actually prefer prompting opposed to handing out configuration options before script execution.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">database_type</span> <span class="o">=</span> <span class="n">ask</span><span class="p">(</span><span class="s2">&quot;Do you want to use postgres or mysql?&quot;</span><span class="p">,</span> <span class="ss">limited_to</span><span class="p">:</span> <span class="o">[</span><span class="s2">&quot;pg&quot;</span><span class="p">,</span> <span class="s2">&quot;mysql&quot;</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">adapter</span> <span class="o">=</span> <span class="k">if</span> <span class="n">database_type</span> <span class="o">==</span> <span class="s1">&#39;pg&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;pg&#39;</span>
</span><span class='line'>  <span class="s1">&#39;postgresql&#39;</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;mysql2&#39;</span>
</span><span class='line'>  <span class="s1">&#39;mysql2&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">database_file</span> <span class="o">=</span> <span class="o">&lt;&lt;-</span><span class="no">FILE</span>
</span><span class='line'><span class="sh">default: &amp;default</span>
</span><span class='line'><span class="sh">  adapter: &lt;%= adapter %&gt;</span>
</span><span class='line'><span class="sh">  pool: 5</span>
</span><span class='line'><span class="sh">  timeout: 5000</span>
</span><span class='line'><span class="sh">  host: localhost</span>
</span><span class='line'><span class="sh">  username: root</span>
</span><span class='line'>
</span><span class='line'><span class="sh">development:</span>
</span><span class='line'><span class="sh">  &lt;&lt;: *default</span>
</span><span class='line'><span class="sh">  database: &lt;%= @app_name %&gt;_development</span>
</span><span class='line'><span class="sh">  password:</span>
</span><span class='line'>
</span><span class='line'><span class="sh">test:</span>
</span><span class='line'><span class="sh">  &lt;&lt;: *default</span>
</span><span class='line'><span class="sh">  database: &lt;%= @app_name %&gt;_test</span>
</span><span class='line'>
</span><span class='line'><span class="sh">production:</span>
</span><span class='line'><span class="sh">  &lt;&lt;: *default</span>
</span><span class='line'><span class="sh">  database: &lt;%= @app_name %&gt;_production</span>
</span><span class='line'><span class="no">FILE</span>
</span><span class='line'>
</span><span class='line'><span class="n">create_file</span> <span class="s1">&#39;config/database.yml&#39;</span><span class="p">,</span> <span class="no">ERB</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="nb">binding</span><span class="p">),</span> <span class="ss">force</span><span class="p">:</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>Remove unwanted gems (I never use sqlite nor coffescript). Spring will be added later in the development group of gems.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="sx">%w(spring coffee-rails sqlite3)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">unwanted_gem</span><span class="o">|</span>
</span><span class='line'>  <span class="n">gsub_file</span><span class="p">(</span><span class="s2">&quot;Gemfile&quot;</span><span class="p">,</span> <span class="sr">/gem &#39;</span><span class="si">#{</span><span class="n">unwanted_gem</span><span class="si">}</span><span class="sr">&#39;.*\n/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I use <a href="http://slim-lang.com/">slim</a> as a templating engine, so I replace the ERB layout:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">layout_file</span> <span class="o">=</span> <span class="o">&lt;&lt;-</span><span class="no">FILE</span>
</span><span class='line'><span class="sh">doctype html</span>
</span><span class='line'><span class="sh">html</span>
</span><span class='line'><span class="sh">  head</span>
</span><span class='line'><span class="sh">    title &lt;%= @app_name.titleize %&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sh">    = stylesheet_link_tag    &#39;application&#39;, media: &#39;all&#39;, &#39;data-turbolinks-track&#39; =&gt; true</span>
</span><span class='line'><span class="sh">    = javascript_include_tag &#39;application&#39;, &#39;data-turbolinks-track&#39; =&gt; true</span>
</span><span class='line'><span class="sh">    = csrf_meta_tags</span>
</span><span class='line'>
</span><span class='line'><span class="sh">  body</span>
</span><span class='line'><span class="sh">    = yield</span>
</span><span class='line'><span class="no">FILE</span>
</span><span class='line'>
</span><span class='line'><span class="n">remove_file</span> <span class="s1">&#39;app/views/layouts/application.html.erb&#39;</span>
</span><span class='line'><span class="n">create_file</span> <span class="s1">&#39;app/views/layouts/application.html.slim&#39;</span><span class="p">,</span> <span class="no">ERB</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">layout_file</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="nb">binding</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Remove comments and double newlines from the Gemfile:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gsub_file</span><span class="p">(</span><span class="s2">&quot;Gemfile&quot;</span><span class="p">,</span> <span class="sr">/#.*\n/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">gsub_file</span><span class="p">(</span><span class="s2">&quot;Gemfile&quot;</span><span class="p">,</span> <span class="sr">/^\n\n/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>I oftenly use <a href="https://github.com/plataformatec/simple_form/">simple form</a>, and the question is only if I&rsquo;ll use bootstrap. 99% of times it&rsquo;s yes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">simple_form_installation</span> <span class="o">=</span> <span class="s2">&quot;simple_form:install&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">yes?</span><span class="p">(</span><span class="s1">&#39;Use bootstrap?&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;bootstrap-sass&#39;</span>
</span><span class='line'>  <span class="n">simple_form_installation</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot; --bootstrap&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now the fun part, adding my usual gem toolbelt. I use <a href="https://github.com/drapergem/draper">draper</a> for better separation of presentation and business logic.
<a href="https://github.com/charliesome/better_errors">Better errors</a> &amp; <a href="https://github.com/banister/binding_of_caller">binding of caller</a> for nicer error pages (will see if I&rsquo;ll stay with it since Rails 4.2.0 will come out with it&rsquo;s own <a href="https://github.com/rails/web-console">web-console</a>).
I love to use <a href="http://pryrepl.org/">pry</a> for easier debugging and for surfing around the codebase, so I added the <a href="https://github.com/rweng/pry-rails">pry-rails</a> gem. I also use <a href="https://github.com/flyerhzm/bullet">Bullet</a> for optimizing my SQL queries, <a href="https://github.com/amatsuda/traceroute">traceroute</a> for keeping my routes nice and tidy and the <a href="https://github.com/ryanb/letter_opener">letter opener</a> gem for easier mail previewing (I still have to try <a href="http://richonrails.com/articles/action-mailer-previews-in-ruby-on-rails-4-1">Action mailer previews</a> to see if they&rsquo;re a better fit):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;simple_form&#39;</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;slim-rails&#39;</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;draper&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">gem_group</span> <span class="ss">:development</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;spring&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;better_errors&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;binding_of_caller&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;quiet_assets&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;pry-rails&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;bullet&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;traceroute&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;letter_opener&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run bundle install and install simple form:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">run</span> <span class="s2">&quot;bundle install&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">generate</span> <span class="n">simple_form_installation</span>
</span></code></pre></td></tr></table></div></figure>


<p>Initialize a git repository and append usual pesky files (this can also be done through global config):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">git</span> <span class="ss">:init</span>
</span><span class='line'><span class="sx">%w(.sass-cache powder public/system dump.rdb logfile .DS_Store)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">gitignored</span><span class="o">|</span>
</span><span class='line'>  <span class="n">append_file</span> <span class="s2">&quot;.gitignore&quot;</span><span class="p">,</span> <span class="n">gitignored</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="n">git</span> <span class="ss">add</span><span class="p">:</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="ss">commit</span><span class="p">:</span> <span class="s2">&quot;-m &#39;Initial commit&#39;&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s it, as you see, I don&rsquo;t have that much of setting up to do (since the apps I do often differ from each other quite a lot) so rails application templates are just the right tool for me.</p>

<p>The nice part about this is that if I don&rsquo;t need some tools included in the script, I can always copy the file locally, remove it manually and roll the script. However, since I&rsquo;ve added just the minimal amount of tools to get me started I&rsquo;ve never needed to kick something out.</p>

<p>That&rsquo;s it, hope you find this useful, and if you&rsquo;ve got suggestions, do share them.</p>
]]></content>
  </entry>
  
</feed>
